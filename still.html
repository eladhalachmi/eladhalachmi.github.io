<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steal the Brainrot 3D - Custom Models & Base</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; user-select: none; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #hud { position: absolute; bottom: 20px; right: 20px; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 15px; border: 2px solid #fbbf24; color: white; min-width: 180px; box-shadow: 0 0 20px rgba(251, 191, 36, 0.2); pointer-events: auto; }
        
        #shop-toggle { position: absolute; top: 20px; left: 20px; pointer-events: auto; width: 60px; height: 60px; background: #f43f5e; border-radius: 15px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white; box-shadow: 0 0 15px rgba(244, 63, 94, 0.6); z-index: 50; transition: transform 0.2s; }
        #shop-sidebar { position: absolute; top: 90px; left: 20px; pointer-events: auto; background: rgba(15, 15, 15, 0.98); padding: 20px; border: 3px solid #f43f5e; border-radius: 20px; color: white; width: 260px; display: none; z-index: 50; }
        
        .shop-btn { background: linear-gradient(to bottom, #f43f5e, #be123c); color: white; padding: 14px; width: 100%; border-radius: 12px; font-weight: bold; margin-top: 10px; cursor: pointer; border: none; transition: all 0.2s; box-shadow: 0 4px 0 #991b1b; text-align: center; }
        .fire-btn { background: linear-gradient(to bottom, #ff9800, #e65100); box-shadow: 0 4px 0 #bf360c; }

        #instructions { position: absolute; top: 20px; right: 20px; color: #fff; text-align: right; font-size: 13px; pointer-events: none; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div id="instructions">
            WASD - 转注 | 拽拽  - 爪<br>
            <b class="text-yellow-400">W 驻 - 专爪 专</b><br>
            <b class="text-rose-400">E - 拽 住注</b><br>
            <b class="text-green-400">注 注  专拽 住祝 住祝</b>
        </div>

        <div id="shop-toggle" onclick="toggleShop()">
            <svg viewBox="0 0 24 24" width="30" height="30" fill="white"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
        </div>

        <div id="shop-sidebar">
            <h3 class="text-center font-bold text-rose-400 text-xl mb-4">转 VIP</h3>
            <button class="shop-btn fire-btn text-sm py-2" onclick="buyFireLuck()"> 驻 4  ($20)</button>
        </div>

        <div id="hud">
            <div class="text-3xl font-bold text-yellow-400 mb-1">$<span id="money">100</span></div>
            <div id="luck-multiplier" class="text-sm text-orange-400 font-bold mb-2">: x1</div>
            <div class="text-md text-gray-200">注转: <span id="base-count">0</span>/10</div>
        </div>
    </div>

    <script>
        // --- 爪 砖拽 ---
        let money = 100;
        let luckMultiplier = 1;
        const keys = {};

        // --- 爪 转注 ---
        let isRightMouseDown = false;
        let cameraAngle = 0;
        let cameraDistance = 50;
        let cameraHeight = 35;
        let lastWTime = 0;
        let isSprinting = false;

        // --- 专砖转 转 驻 专转  (砖 拽) ---
        const BRAINROT_TYPES = [
            { id: "noobini", name: " 驻爪", price: 15, value: 1, rarity: "Common", color: "#9ca3af", scale: 0.7 },
            { id: "lirili", name: "专  专", price: 150, value: 8, rarity: "Rare", color: "#3b82f6", scale: 0.85 },
            { id: "tomcheese", name: "转 爪'", price: 650, value: 35, rarity: "Epic", color: "#a855f7", scale: 0.9 },
            { id: "borbeloni", name: "专  ", price: 2000, value: 235, rarity: "Legendary", color: "#eab308", scale: 1.1 },
            { id: "dolphinit", name: "转 驻", price: 5500, value: 550, rarity: "Mythic", color: "#f43f5e", scale: 1.15 },
            { id: "champanzini", name: "砖驻 ", price: 12000, value: 1200, rarity: "Divine", color: "#22c55e", scale: 1.3 }
        ];

        // --- 转 Three.js ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0c);
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const sun = new THREE.DirectionalLight(0xffffff, 0.7);
        sun.position.set(50, 100, 50);
        scene.add(sun);

        // 转 驻
        function createMap() {
            // 专爪驻 专爪驻转
            const floorGeo = new THREE.PlaneGeometry(200, 200);
            const floorMat = new THREE.MeshPhongMaterial({ color: 0x151515 });
            const floor = new THREE.Mesh(floorGeo, floorMat);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // 拽专转
            const wallMat = new THREE.MeshPhongMaterial({ color: 0x222222 });
            const createWall = (w, h, d, x, y, z) => {
                const wall = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), wallMat);
                wall.position.set(x, y, z);
                scene.add(wall);
            };
            createWall(160, 15, 4, 0, 7.5, -60); // 拽专 专
            createWall(4, 15, 120, -80, 7.5, 0); // 拽专 砖
            createWall(4, 15, 120, 80, 7.5, 0);  // 拽专 

            // 住注
            const beltBase = new THREE.Mesh(new THREE.BoxGeometry(12, 1.8, 120), new THREE.MeshPhongMaterial({ color: 0x333333 }));
            beltBase.position.set(-45, 0.9, 0);
            scene.add(beltBase);
            
            const beltTop = new THREE.Mesh(new THREE.BoxGeometry(11, 0.2, 120), new THREE.MeshPhongMaterial({ color: 0x111111 }));
            beltTop.position.set(-45, 1.9, 0);
            scene.add(beltTop);

            // 转专 拽专转
            for (let i = -50; i <= 50; i += 25) {
                const pillar = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 15, 8), wallMat);
                pillar.position.set(75, 7.5, i);
                scene.add(pillar);
                const neon = new THREE.PointLight(0xf43f5e, 1.5, 30);
                neon.position.set(75, 15, i);
                scene.add(neon);
            }
        }
        createMap();

        // 砖拽
        const player = new THREE.Group();
        const pBody = new THREE.Mesh(new THREE.BoxGeometry(1.5, 3, 1), new THREE.MeshPhongMaterial({ color: 0x00ccff }));
        pBody.position.y = 1.5;
        player.add(pBody);
        player.position.set(0, 0, 30);
        scene.add(player);

        // 注转 爪专
        const slots = [];
        const sidesX = [-20, 20]; 
        for (let side of sidesX) {
            for (let i = 0; i < 5; i++) {
                const z = -40 + (i * 20);
                const slotMesh = new THREE.Mesh(new THREE.BoxGeometry(12, 0.6, 12), new THREE.MeshPhongMaterial({ color: 0x2a2a2a }));
                slotMesh.position.set(side, 0.3, z);
                scene.add(slotMesh);

                const collectorX = side + (side < 0 ? 10 : -10);
                const collector = new THREE.Mesh(new THREE.BoxGeometry(4, 0.4, 6), new THREE.MeshPhongMaterial({ color: 0x22c55e, emissive: 0x114411 }));
                collector.position.set(collectorX, 0.2, z);
                scene.add(collector);

                const label = createTextLabel("专拽", 0.7);
                label.position.set(collectorX, 6, z);
                scene.add(label);

                slots.push({ x: side, z, occupied: false, data: null, model: null, collectedMoney: 0, label, collector });
            }
        }

        // 爪专转 爪专转 转 驻 拽砖转 砖转砖
        function createCharacterModel(type) {
            const group = new THREE.Group();
            const scale = type.scale || 1;

            if (type.id === "champanzini") {
                // 砖驻  - 拽祝 专拽 
                const banana = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.4, 3.5, 8), new THREE.MeshPhongMaterial({ color: 0xffe135 }));
                banana.rotation.z = 0.5; banana.position.y = 1; group.add(banana);
                const head = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1.5, 1.5), new THREE.MeshPhongMaterial({ color: 0x16a34a }));
                head.position.y = 2.8; group.add(head);
                const snout = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.6, 0.5), new THREE.MeshPhongMaterial({ color: 0xfca5a5 }));
                snout.position.set(0, 2.6, 0.8); group.add(snout);
            } 
            else if (type.id === "dolphinit") {
                // 转 驻 - 驻 爪
                const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.8, 3, 4, 8), new THREE.MeshPhongMaterial({ color: 0xffea00 }));
                body.rotation.x = Math.PI / 2.5; body.position.y = 1.5; group.add(body);
                const finTop = new THREE.Mesh(new THREE.CylinderGeometry(0, 0.4, 1, 3), new THREE.MeshPhongMaterial({ color: 0xffd600 }));
                finTop.position.set(0, 2.5, 0.5); group.add(finTop);
            } 
            else if (type.id === "borbeloni") {
                // 专 - 拽驻专/专 专 
                const body = new THREE.Mesh(new THREE.BoxGeometry(2.5, 1.6, 4), new THREE.MeshPhongMaterial({ color: 0x5d4037 }));
                body.position.y = 0.8; group.add(body);
                const head = new THREE.Mesh(new THREE.BoxGeometry(1.4, 1.4, 1.6), new THREE.MeshPhongMaterial({ color: 0x4e342e }));
                head.position.set(0, 1.5, 2.2); group.add(head);
            } 
            else if (type.id === "tomcheese") {
                // 转 爪' -  注 专
                const cheese = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 2.5, 2, 3), new THREE.MeshPhongMaterial({ color: 0xffd600 }));
                cheese.position.y = 1; group.add(cheese);
                for(let i=0; i<10; i++) {
                    const hole = new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshPhongMaterial({ color: 0xb58900 }));
                    hole.position.set(Math.random()*2-1, Math.random()*1.5+0.5, Math.random()*2-1);
                    group.add(hole);
                }
            } 
            else if (type.id === "lirili") {
                // 专  专 - 驻 专拽
                const body = new THREE.Mesh(new THREE.BoxGeometry(2, 1.5, 2.5), new THREE.MeshPhongMaterial({ color: 0x4caf50 }));
                body.position.y = 0.75; group.add(body);
                const head = new THREE.Mesh(new THREE.BoxGeometry(1.4, 1.2, 1.2), new THREE.MeshPhongMaterial({ color: 0x4caf50 }));
                head.position.set(0, 1.6, 1.5); group.add(head);
                const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 2), new THREE.MeshPhongMaterial({ color: 0x388e3c }));
                trunk.rotation.x = -0.6; trunk.position.set(0, 0.6, 2.2); group.add(trunk);
            } 
            else {
                //  - 转 驻砖 爪
                const torso = new THREE.Mesh(new THREE.BoxGeometry(1.5, 2, 0.8), new THREE.MeshPhongMaterial({ color: 0xffff00 }));
                torso.position.y = 1; group.add(torso);
                const head = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), new THREE.MeshPhongMaterial({ color: 0xffd600 }));
                head.position.y = 2.5; group.add(head);
            }

            group.scale.set(scale, scale, scale);
            return group;
        }

        function createBeltLabel(data, scale = 1) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 512; canvas.height = 350;
            ctx.textAlign = "center";
            ctx.fillStyle = data.color; ctx.font = "Bold 44px Arial"; ctx.fillText(data.rarity.toUpperCase(), 256, 50);
            ctx.fillStyle = "#ffffff"; ctx.font = "Bold 58px Arial"; ctx.fillText(data.name, 256, 130);
            ctx.fillStyle = "#4ade80"; ctx.font = "Bold 48px Arial"; ctx.fillText(`$${data.value}/砖`, 256, 210);
            ctx.fillStyle = "#fbbf24"; ctx.font = "Bold 48px Arial"; ctx.fillText(`专: $${data.price}`, 256, 300);
            const tex = new THREE.CanvasTexture(canvas);
            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: tex }));
            sprite.scale.set(13 * scale, 9 * scale, 1);
            return sprite;
        }

        function createTextLabel(text, scale = 1) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 512; canvas.height = 128;
            ctx.fillStyle = "white"; ctx.font = "Bold 50px Arial"; ctx.textAlign = "center";
            ctx.fillText(text, 256, 80);
            const tex = new THREE.CanvasTexture(canvas);
            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: tex }));
            sprite.scale.set(8 * scale, 2 * scale, 1);
            sprite.userData = { canvas, ctx, tex };
            return sprite;
        }

        function updateLabel(sprite, text) {
            const { ctx, canvas, tex } = sprite.userData;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#ffffff"; ctx.fillText(text, 256, 80);
            tex.needsUpdate = true;
        }

        let itemsOnBelt = [];
        let spawnTimer = 0;
        function spawnBeltItem() {
            let type;
            const r = Math.random();
            if (r < 0.35) type = BRAINROT_TYPES[0];
            else if (r < 0.60) type = BRAINROT_TYPES[1];
            else if (r < 0.80) type = BRAINROT_TYPES[2];
            else if (r < 0.90) type = BRAINROT_TYPES[3];
            else if (r < 0.97) type = BRAINROT_TYPES[4];
            else type = BRAINROT_TYPES[5];

            const group = new THREE.Group();
            group.add(createCharacterModel(type));
            const label = createBeltLabel(type, 0.6);
            label.position.y = 6;
            group.add(label);
            group.position.set(-45, 2, -60); 
            scene.add(group);
            itemsOnBelt.push({ mesh: group, data: type });
        }

        window.toggleShop = () => {
            const s = document.getElementById('shop-sidebar');
            s.style.display = s.style.display === 'block' ? 'none' : 'block';
        };

        window.buyFireLuck = () => {
            if(money >= 20) { money -= 20; luckMultiplier = 4; document.getElementById('luck-multiplier').innerText = ": x4 "; updateUI(); }
        };

        function addToSlot(type) {
            const slot = slots.find(s => !s.occupied);
            if (!slot) return;
            const model = createCharacterModel(type);
            model.position.set(slot.x, 1, slot.z);
            scene.add(model);
            slot.occupied = true; slot.data = type; slot.model = model; slot.collectedMoney = 0;
            updateLabel(slot.label, `$0 (+$${type.value}/s)`);
            updateUI();
        }

        function updateUI() {
            document.getElementById('money').innerText = Math.floor(money).toLocaleString();
            document.getElementById('base-count').innerText = slots.filter(s => s.occupied).length;
        }

        let incomeTimer = 0;
        function animate() {
            requestAnimationFrame(animate);
            const speed = isSprinting ? 1.25 : 0.55;
            let dx = 0, dz = 0;
            if (keys['w']) dz += 1; if (keys['s']) dz -= 1; if (keys['a']) dx += 1; if (keys['d']) dx -= 1;
            if (dx !== 0 || dz !== 0) {
                const fx = Math.sin(cameraAngle), fz = Math.cos(cameraAngle);
                const rx = Math.sin(cameraAngle + Math.PI/2), rz = Math.cos(cameraAngle + Math.PI/2);
                player.position.x += (fx * dz + rx * dx) * speed;
                player.position.z += (fz * dz + rz * dx) * speed;
                player.rotation.y = Math.atan2(fx * dz + rx * dx, fz * dz + rz * dx);
            }
            camera.position.set(player.position.x - Math.sin(cameraAngle) * cameraDistance, player.position.y + cameraHeight, player.position.z - Math.cos(cameraAngle) * cameraDistance);
            camera.lookAt(player.position.x, player.position.y + 2, player.position.z);

            spawnTimer++;
            if (spawnTimer > 110) { spawnBeltItem(); spawnTimer = 0; }
            for (let i = itemsOnBelt.length - 1; i >= 0; i--) {
                const item = itemsOnBelt[i];
                item.mesh.position.z += 0.32;
                if (player.position.distanceTo(item.mesh.position) < 8 && keys['e']) {
                    if (money >= item.data.price && slots.some(s => !s.occupied)) {
                        money -= item.data.price; addToSlot(item.data); scene.remove(item.mesh);
                        itemsOnBelt.splice(i, 1); updateUI();
                    }
                }
                if (item.mesh.position.z > 60) { scene.remove(item.mesh); itemsOnBelt.splice(i, 1); }
            }

            incomeTimer++;
            const secondPassed = incomeTimer >= 60;
            if (secondPassed) incomeTimer = 0;
            slots.forEach(slot => {
                if (slot.occupied) {
                    if (secondPassed) {
                        slot.collectedMoney += slot.data.value * luckMultiplier;
                        updateLabel(slot.label, `$${slot.collectedMoney} (+$${slot.data.value}/s)`);
                    }
                    if (player.position.distanceTo(slot.collector.position) < 6) {
                        if (slot.collectedMoney > 0) {
                            money += slot.collectedMoney; slot.collectedMoney = 0;
                            updateLabel(slot.label, `$0 (+$${slot.data.value}/s)`); updateUI();
                        }
                    }
                    slot.model.rotation.y += 0.03;
                    slot.model.position.y = 1.5 + Math.sin(Date.now() * 0.005) * 0.5;
                }
            });
            renderer.render(scene, camera);
        }

        window.addEventListener('keydown', e => {
            const k = e.key.toLowerCase(); keys[k] = true;
            if (k === 'w') { const n = Date.now(); if (n - lastWTime < 250) isSprinting = true; lastWTime = n; }
        });
        window.addEventListener('keyup', e => { const k = e.key.toLowerCase(); keys[k] = false; if (k === 'w') isSprinting = false; });
        window.addEventListener('mousedown', e => { if (e.button === 2) isRightMouseDown = true; });
        window.addEventListener('mouseup', e => { if (e.button === 2) isRightMouseDown = false; });
        window.addEventListener('mousemove', e => { if (isRightMouseDown) cameraAngle -= e.movementX * 0.008; });
        window.oncontextmenu = e => e.preventDefault();
        window.onload = animate;
    </script>
</body>
</html>

